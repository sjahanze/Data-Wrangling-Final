---
title: "HW 3"
author: "Shahzaib Jahanzeb"
date: "2025-11-23"
output: html_document
---
```{r}
library(forecast)
```

```{r}
data <- read.table('./co2_monthly.txt', header=T)
co2_ts <- ts(data$value, start=c(1985,6), frequency=12)
co2_ts_sub <- window(co2_ts, start=c(2015,1))
```

```{r}
model1 <- tslm(co2_ts_sub ~ trend + season)
checkresiduals(model1)
Acf(model1$residuals)
```



```{r}
model2 <- auto.arima(co2_ts_sub)
model2
```



```{r}
xreg <- cbind(seq_along(co2_ts_sub), seasonaldummy(co2_ts_sub))

model3 <- auto.arima(co2_ts_sub, xreg=xreg)
model3
```


```{r}
mae_func <- function(x) { mean(abs(x), na.rm = TRUE) }

model1_forecast <- function(x, h) {
  model <- tslm(x ~ trend + season)
  model_pred <- forecast(model, h = h)
  return(model_pred)
}

model1_CVerr <- tsCV(co2_ts_sub,
                     forecastfunction = model1_forecast,
                     h = 24,
                     window = 60)

model1_MAE <- apply(model1_CVerr, 2, mae_func)
model1_MAE

```

```{r}
library(forecast)

# Define MAE function
mae_func <- function(x) { mean(abs(x), na.rm = TRUE) }

# Define forecasting function for fixed SARIMA(3,0,0)(0,1,2)[12]
model_sarima_forecast <- function(y, h) {
  model <- Arima(y, order = c(3,0,0),
                    seasonal = c(0,1,2))
  model_pred <- forecast(model, h = h)
  return(model_pred)
}

# Run sliding-window tsCV
sarima_CVerr <- tsCV(co2_ts_sub,
                     forecastfunction = model_sarima_forecast,
                     h = 24,
                     window = 60)

# Compute MAE at h = 24
sarima_MAE <- apply(sarima_CVerr, 2, mae_func)
mean(sarima_MAE, na.rm = TRUE)


```

```{r}
mae_func <- function(x) { mean(abs(x), na.rm = TRUE) }

## --- Dynamic regression forecast function: ARIMA(1,0,1) with trend + seasonal dummies ---
model3_forecast <- function(x, h, xreg, newxreg) {
  model <- Arima(x,
                 order = c(1, 0, 1),   # ARIMA(1,0,1) for error process
                 xreg  = xreg)        # exogenous regressors: trend + season
  model_pred <- forecast(model, h = h, xreg = newxreg)
  return(model_pred)
}

## --- Build exogenous regressors for entire series (trend + seasonal dummies) ---
xreg_total <- cbind(
  seq_along(co2_ts_sub),        # linear trend
  seasonaldummy(co2_ts_sub)     # seasonal dummy variables
)

## --- Sliding-window tsCV: h = 24, window = 60 ---
model3_CVerr <- tsCV(co2_ts_sub,
                     forecastfunction = model3_forecast,
                     h       = 24,
                     window  = 60,
                     xreg    = xreg_total)

## --- Compute MAE by horizon (h = 1,...,24) ---
model3_pred_err <- apply(model3_CVerr, 2, mae_func)
model3_pred_err          # MAE for each horizon

## --- MAE for h = 24 months ahead ---
model3_MAE_h24 <- model3_pred_err[24]
model3_MAE_h24
```